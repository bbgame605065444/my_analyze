

# **Hierarchical Classification of Electrocardiograms: A Methodological and Datasheet Compendium**

## **Introduction: The Evolution from Flat to Hierarchical ECG Diagnosis**

The application of machine learning to electrocardiogram (ECG) interpretation has rapidly progressed from simple binary classifiers to complex multi-class systems capable of identifying a wide range of cardiac abnormalities. However, these "flat" classification models, which treat each diagnosis as an independent and unrelated category, fundamentally diverge from the nuanced reasoning process of a human cardiologist. A clinician's diagnostic workflow is inherently hierarchical; they first identify broad categories of abnormalities—such as a conduction disturbance or evidence of myocardial infarction—before narrowing the diagnosis to a specific condition, like a left bundle branch block or an acute anterior MI.1 This hierarchical approach allows for a structured understanding of the patient's condition, where even a partial or high-level diagnosis provides significant clinical value.

The limitations of flat models become apparent in this clinical context. They often struggle with the vast number of possible diagnoses, face challenges with class imbalance where rare but critical conditions are underrepresented, and provide outputs that lack the structured, interpretable nature of a clinical assessment. A flat model that misclassifies an "anterior myocardial infarction" as a "conduction disturbance" makes a more clinically significant error than one that misclassifies it as an "inferior myocardial infarction," yet traditional accuracy metrics would penalize both errors equally.

To bridge this gap between machine output and clinical reasoning, the field is moving towards hierarchical classification (HC). Hierarchical models are explicitly designed to respect the taxonomic relationships between different diagnoses, structuring their predictions within a predefined or data-driven class hierarchy. This paradigm shift promises models that are not only more accurate but also more interpretable and clinically relevant. By organizing predictions into a tree or a Directed Acyclic Graph (DAG), these models can provide insights at multiple levels of abstraction, mirroring the cardiologist's thought process and enabling more robust decision support.

This report serves as a comprehensive methodological and datasheet compendium for the application of hierarchical classification to ECG analysis. It is structured to guide the researcher from theoretical foundations to practical implementation. Section 1 details the architectural paradigms of hierarchical models, exploring how clinical taxonomies inform their design and contrasting different training methodologies. Section 2 provides a granular analysis of publicly available ECG datasets, identifying those with explicit, ready-to-use hierarchical label structures and outlining methods for imposing a hierarchy on large, unstructured multi-label datasets. Section 3 covers the practical frameworks for implementation and the specialized protocols for evaluation that are essential for meaningfully assessing hierarchical model performance. Finally, Section 4 synthesizes these findings into strategic recommendations for dataset selection, model development, and future research, aiming to equip practitioners with the knowledge to build the next generation of intelligent ECG interpretation systems.

---

## **Section 1: Architectural Paradigms for Hierarchical ECG Classification**

The design of a hierarchical classification model is not an arbitrary choice but a deliberate process of encoding domain knowledge into the model's structure. This section explores the foundational principles that guide the creation of these architectures, from leveraging established clinical taxonomies to discovering latent class relationships directly from data. It further contrasts the primary methodological approaches—local versus global classifiers—that govern how these hierarchical structures are learned.

### **1.1 The Foundation: From Clinical Taxonomies to Model Hierarchies**

The most robust and interpretable hierarchical models are those grounded in the established knowledge of the clinical domain. This pre-existing structure, codified in medical standards and diagnostic practices, provides a validated blueprint for a model's label hierarchy, ensuring its outputs are clinically meaningful.

**SCP-ECG Standard:** The Standard Communications Protocol for Computer-Assisted Electrocardiography (SCP-ECG) is a critical international standard that specifies the format for ECG data interchange, including a structured set of diagnostic statements.4 Datasets that adhere to this standard, most notably the PTB-XL dataset, offer a natural and explicit hierarchy. The SCP-ECG statements are organized into categories such as diagnostic, form, and rhythm, with the diagnostic statements further aggregated into superclasses (broad pathological categories) and subclasses (specific findings).8 This provides a direct, two-level taxonomy that can be mapped onto a model's output layer, allowing the model to learn to predict both the general type of cardiac abnormality and the specific diagnosis.

**Severity-Based Hierarchies:** Clinical diagnosis often involves not just identifying a condition but also staging its severity. This naturally lends itself to a hierarchical model structure. For example, in the analysis of small bowel biopsies for Celiac Disease, a hierarchical model can be designed to first perform a binary classification (Celiac Disease vs. Normal/Other) and then, for positive cases, a secondary classification into severity levels based on the Modified Marsh Score (e.g., Marsh I, IIIa, IIIb, IIIc).1 This multi-step approach mirrors the clinical workflow of diagnosis followed by grading, making the model's output highly interpretable and directly applicable to patient management. A similar principle can be applied to ECGs, where a model might first identify myocardial infarction and then classify its stage (e.g., acute, recent, old).

**Pathophysiological Grouping:** Hierarchies can also be constructed based on the underlying electrophysiological origin of different cardiac conditions. This is particularly relevant for arrhythmia classification. The Chapman-Shaoxing dataset provides a clear example of this approach, where 11 distinct rhythm types are aggregated into four clinically meaningful superclasses: Atrial Fibrillation (AFIB), General Supraventricular Tachycardia (GSVT), Sinus Bradycardia (SB), and Sinus Rhythm (SR).13 This grouping is not arbitrary; it reflects the clinical reality that different forms of supraventricular tachycardia (e.g., Atrial Tachycardia, AV Nodal Reentrant Tachycardia) share a common origin above the ventricles and can be challenging to differentiate on a short, 10-second ECG strip. By training a model to first identify the broader GSVT category, it can make a clinically useful prediction even when it lacks the confidence to pinpoint the exact subtype.

### **1.2 Methodological Approaches: Local vs. Global Classifiers**

Once a hierarchy is defined, there are two primary strategies for training a model to learn it: the local (top-down) approach and the global (big-bang) approach. Each presents a different set of trade-offs in terms of implementation complexity, training dynamics, and error handling.15

**Local Classifiers (Top-Down Approach):** This strategy decomposes the hierarchical problem into a series of simpler, flat classification tasks, with one classifier trained for each level or node in the hierarchy.2 The process begins at the root of the hierarchy. A top-level classifier is trained to distinguish between the broad, parent-level categories. The prediction from this first classifier then determines which subsequent, specialized classifier is used at the next level down. For instance, a model might first classify an ECG into NORM, MI, or CD. If the prediction is MI, a second, specialized model trained only on MI subtypes would then classify it as anterior, inferior, or lateral MI.

This architecture can be implemented as a stack of deep learning models. The Hierarchical Medical Image Classification (HMIC) framework, for example, uses one Convolutional Neural Network (CNN) to predict the parent class and then routes the input to a separate, dedicated CNN for predicting the child class.1 The primary challenge of this approach is

**error propagation**. An incorrect prediction at a higher level is irreversible; the model proceeds down the wrong branch of the hierarchy, and all subsequent predictions will be incorrect.2 To mitigate this, systems can implement confidence thresholds, refusing to proceed to a lower level of classification if the confidence of the parent-level prediction is below a certain value, thereby trading completeness for accuracy.

**Global Classifiers (Big-Bang Approach):** In contrast, the global approach utilizes a single, unified model that is trained to predict labels across all levels of the hierarchy simultaneously.15 This is typically achieved with a multi-output network architecture, where the final layer is structured to produce predictions for each level of the hierarchy. The key to this approach lies in the design of the loss function, which must be constructed to enforce hierarchical consistency. For example, the loss function would heavily penalize a prediction where a subclass (e.g., "anterior MI") is predicted with high confidence but its corresponding superclass ("MI") is not.17

The global approach has the significant advantage of being able to learn the complex interdependencies between different levels of the hierarchy in an end-to-end fashion, potentially leading to higher overall accuracy and avoiding the issue of error propagation. However, this comes at the cost of significantly increased model complexity and more challenging training dynamics. The design of an effective loss function that correctly balances the learning across all levels of the hierarchy is non-trivial and is an active area of research.

### **1.3 Discovering Latent Hierarchies from Data**

While leveraging pre-defined clinical taxonomies is often the preferred approach, there are scenarios where such a hierarchy is not available, or where a data-driven structure may reveal novel clinical insights. In these cases, the hierarchy itself must be discovered from the data or from the behavior of a trained model.

**Analysis of Confusion Matrices:** The confusion matrix of a well-trained, flat multi-class classifier is a rich source of information about the relationships between classes.18 Classes that the model frequently confuses (indicated by high values in the off-diagonal cells of the matrix) are likely to be semantically or featurally similar.20 For example, if a model often misclassifies "incomplete right bundle branch block" as "right bundle branch block," it suggests these two classes are closely related. By systematically analyzing these confusion patterns, one can perform a bottom-up grouping of classes. Pairs or groups of highly confused classes can be merged into a parent superclass, forming the first level of a new, data-driven hierarchy.22 This process transforms a diagnostic byproduct of a flat model into a powerful tool for designing a more sophisticated hierarchical architecture, suggesting an iterative workflow where the results of one model inform the structure of the next.

**Clustering of Label Embeddings:** For datasets with descriptive text labels, an alternative and powerful method for hierarchy discovery is to use natural language processing techniques. Each class label can be converted into a high-dimensional vector representation, or "embedding," using pre-trained language models like Sentence Transformers.24 These embeddings capture the semantic meaning of the labels. Once all labels are represented as vectors in a common space, hierarchical clustering algorithms (such as agglomerative clustering) can be applied.25 The algorithm iteratively merges the closest label embeddings, producing a dendrogram that visually represents a tree-like hierarchy of the labels based on their semantic similarity.28 This approach is particularly effective for discovering relationships in large, complex label sets where manual categorization would be infeasible.

**Probabilistic Transition Models:** More advanced deep learning frameworks can be designed to learn the hierarchy as part of the training process itself. The Label Hierarchy Transition (LHT) model, for instance, explicitly learns a set of **transition matrices** that encode the probabilistic relationships between different levels of the hierarchy.29 For each sample, the model predicts the probability of it belonging to a coarse-grained class given its predicted fine-grained class. This approach not only enforces hierarchical consistency but also models the inherent ambiguity and overlap between related clinical concepts. The model's training is further regularized by a "confusion loss," which encourages the model to acknowledge the similarity between related classes rather than treating them as perfectly orthogonal, leading to more robust and realistic predictions.29 This represents a shift from simply using a fixed hierarchy to dynamically learning the probabilistic structure of the label space.

The choice of architectural paradigm is therefore deeply intertwined with the nature of the available data. Datasets with clear, pre-existing taxonomies like PTB-XL lend themselves to direct implementation of local or global classifiers. In contrast, large, flatly-labeled datasets from sources like the PhysioNet Challenges necessitate a preliminary step of either imposing a hierarchy through ontology mapping or discovering one through data-driven techniques before a hierarchical model can be trained. This establishes a fundamental workflow: the semantic structure of the data must be understood and defined before an appropriate model architecture can be selected.

---

## **Section 2: A Granular Analysis of Public ECG Datasets for Hierarchical Modeling**

The successful development of a hierarchical ECG classifier is contingent upon the availability of suitable training data. An ideal dataset for this purpose is one where the labels are not only accurate but are also organized in a manner that reflects a clinically meaningful hierarchy. This section provides a detailed examination of several key publicly available ECG datasets, evaluating their fitness for hierarchical modeling. It focuses on datasets with explicit, ready-to-use hierarchies and also discusses methodologies for structuring large, multi-label datasets that lack an inherent hierarchical organization.

### **2.1 The PTB-XL Dataset: The Gold Standard for Explicit Diagnostic Hierarchy**

The PTB-XL dataset stands out as the most valuable public resource for developing and benchmarking hierarchical ECG classification models due to its large scale and, most importantly, its structured, standardized annotations.8

**Overview:** PTB-XL contains 21,837 clinical 12-lead ECG recordings, each 10 seconds in length, from 18,885 patients. The annotations were performed by up to two cardiologists and conform to the SCP-ECG standard, resulting in a set of 71 distinct, machine-readable statements covering diagnostic, form, and rhythm abnormalities.9

**The Diagnostic Hierarchy:** The critical feature of PTB-XL for hierarchical classification is the formal organization of its diagnostic labels. The specific diagnostic statements (subclasses) are aggregated into five coarse, clinically relevant superclasses. This provides a well-defined, two-level hierarchy that can be directly used to structure a model's output and loss function. The five diagnostic superclasses are 10:

* **NORM:** Normal ECG  
* **MI:** Myocardial Infarction  
* **CD:** Conduction Disturbance  
* **STTC:** ST/T Change  
* **HYP:** Hypertrophy

**Data Source for Hierarchy Construction:** The ground truth for this hierarchical structure is provided in the scp\_statements.csv file that accompanies the dataset. This file explicitly maps each specific SCP-ECG statement (subclass) to its corresponding diagnostic superclass, providing an unambiguous guide for data preprocessing and label creation.10 The table below presents this complete diagnostic hierarchy, curated directly from the dataset's metadata. This mapping is the essential first step for any researcher looking to leverage PTB-XL for hierarchical classification, as it translates the abstract concept of a hierarchy into a concrete, actionable data structure.

**Table 2.1: The PTB-XL SCP-ECG Diagnostic Hierarchy**

| Diagnostic Superclass | Diagnostic Subclass (SCP-ECG Statement Description) |
| :---- | :---- |
| **NORM** | Normal ECG |
| **MI** | Anterior Myocardial Infarction (AMI) |
|  | Anterolateral Myocardial Infarction (ALMI) |
|  | Anteroseptal Myocardial Infarction |
|  | Inferior Myocardial Infarction (IMI) |
|  | Inferolateral Myocardial Infarction (ILMI) |
|  | Inferoposterior Myocardial Infarction (IPMI) |
|  | Inferoposterolateral Myocardial Infarction |
|  | Lateral Myocardial Infarction (LMI) |
|  | Posterior Myocardial Infarction (PMI) |
|  | Subendocardial injury in various leads (e.g., INJAS, INJAL, INJIN) |
| **CD** | AV block (1st, 2nd, 3rd degree) (\_AVB, 1AVB, 2AVB, 3AVB) |
|  | (Complete/Incomplete) Left Bundle Branch Block (ILBBB, CLBBB) |
|  | (Complete/Incomplete) Right Bundle Branch Block (IRBBB, CRBBB) |
|  | Left Anterior/Posterior Fascicular Block (LAFB/LPFB) |
|  | Non-specific Intraventricular Conduction Disturbance (IVCD) |
|  | Wolff-Parkinson-White Syndrome (WPW) |
| **STTC** | Ischemic ST-T changes in various leads (e.g., ISCA, ISCI, ISCIN) |
|  | Non-specific Ischemic (ISC\_) |
|  | Non-specific ST changes (NST\_) |
|  | Non-specific ST depression (STD\_) |
|  | Non-specific ST elevation (STE\_) |
|  | ST-T changes (STTC) |
|  | Electrolytic disturbance or drug effect (EL) |
| **HYP** | Left Atrial Overload/Enlargement (LAO/LAE) |
|  | Left Ventricular Hypertrophy (LVH) |
|  | Right Atrial Overload/Enlargement (RAO/RAE) |
|  | Right Ventricular Hypertrophy (RVH) |
|  | Septal Hypertrophy (SEHYP) |

*Source: Synthesized from PTB-XL dataset documentation and scp\_statements.csv file*.11

### **2.2 The Chapman-Shaoxing Dataset: A Clinically-Driven Rhythm Hierarchy**

While PTB-XL provides a broad diagnostic hierarchy, the Chapman-Shaoxing dataset offers a large-scale resource with a hierarchy focused specifically on cardiac rhythms. This makes it an ideal choice for developing specialized arrhythmia classifiers.

**Overview:** The full Chapman-Shaoxing database contains 45,152 12-lead ECGs from over 34,000 patients, recorded at 500 Hz.36 The initial release, and the one for which a hierarchy was proposed, contained 10,646 records annotated by experts with 11 common rhythm labels and 67 other cardiovascular conditions.14

**The Rhythm Hierarchy:** The creators of the dataset proposed a pragmatic, clinically-driven aggregation of the 11 specific rhythm labels into 4 broader superclasses.14 This grouping was motivated by the low prevalence of some rhythm types and the clinical difficulty of distinguishing between similar arrhythmias based on a short ECG recording. This aggregation provides a two-level hierarchy that is both statistically more robust for training and more aligned with practical diagnostic workflows. The rationale for merging, for instance, all tachycardias originating from supraventricular locations into a single "General Supraventricular Tachycardia" (GSVT) group stems from the clinical practice of using this general term when a more precise diagnosis is not possible from the ECG alone.14

The resulting hierarchy provides a clear structure for a model focused on arrhythmia detection, allowing it to first identify the general class of rhythm disturbance before attempting a more fine-grained classification. The table below details this expert-endorsed aggregation scheme.

**Table 2.2: Chapman-Shaoxing Rhythm Class Aggregation**

| Merged From (Specific Rhythms) | Merged To (Superclass) |
| :---- | :---- |
| Atrial Fibrillation (AFIB), Atrial Flutter (AF) | **AFIB** |
| Supraventricular Tachycardia (SVT), Atrial Tachycardia (AT), Sinus Atrium to Atrial Wandering Rhythm (SAAWR), Sinus Tachycardia (ST), Atrioventricular Node Reentrant Tachycardia (AVNRT), Atrioventricular Reentrant Tachycardia (AVRT) | **GSVT** |
| Sinus Bradycardia (SB) | **SB** |
| Sinus Rhythm (SR), Sinus Irregularity (SI) | **SR** |

*Source: Zheng, J. et al. A 12-lead Electrocardiogram Database for Arrhythmia Research Covering More Than 10,000 Patients. Sci Data 7, 48 (2020)*.14

### **2.3 Multi-Label Datasets: Structuring the Unstructured**

Beyond datasets with explicit hierarchies, there exist very large-scale ECG collections from initiatives like the PhysioNet/Computing in Cardiology Challenge 2020 and the China Physiological Signal Challenge 2018 (CPSC2018). These datasets are characterized by a large, flat set of multi-label annotations, where each recording can be associated with multiple co-occurring conditions.42 The 2020 Challenge training data, for example, contains 111 unique diagnoses.

**The Challenge and Opportunity:** While these datasets lack a built-in hierarchy, their scale and diversity make them incredibly valuable. The challenge is to impose a meaningful hierarchical structure upon them post-hoc. This creates an opportunity to define custom hierarchies tailored to specific research questions or to align the data with comprehensive medical standards.

**Methodology via Ontology Mapping:** The most rigorous method for structuring these datasets is to map their text-based labels to a standardized medical ontology, such as SNOMED-CT (Systematized Nomenclature of Medicine \- Clinical Terms) or ICD-10-CM (International Classification of Diseases, Tenth Revision, Clinical Modification).47 These ontologies are vast, curated knowledge bases where medical concepts are organized into complex hierarchies (both trees and DAGs). For example, in SNOMED-CT, "Left bundle branch block" is a child concept of "Bundle branch block," which is in turn a child of "Cardiac conduction disorder."

The process involves using terminology mapping tools, such as those available through the Unified Medical Language System (UMLS), to find the corresponding SNOMED-CT or ICD-10-CM code for each label in the dataset.48 Once each label is mapped to a concept in the ontology, the inherent parent-child relationships from that ontology can be extracted and used to define the hierarchical label space for the model. While this is a non-trivial data preprocessing step requiring significant domain expertise, it is a powerful technique that unlocks the potential of large, flatly-labeled datasets for sophisticated hierarchical modeling.

The clear distinction between the diagnostic hierarchy of PTB-XL and the rhythmic hierarchy of Chapman-Shaoxing highlights a crucial consideration for any researcher: the choice of dataset is fundamentally linked to the clinical task. A project aimed at building a broad diagnostic screening tool would be best served by the PTB-XL structure, whereas a project focused on detailed arrhythmia analysis should gravitate towards the Chapman-Shaoxing hierarchy. This establishes a clear pipeline for model development: the clinical objective dictates the choice of dataset and its corresponding hierarchy, which in turn informs the selection of an appropriate model architecture.

---

## **Section 3: Implementation Frameworks and Evaluation Protocols**

Transitioning from the design of hierarchies and the selection of data to practical implementation requires addressing two critical components: how to structure the data for a model to learn the hierarchy, and how to evaluate the model's performance in a way that respects that hierarchical structure. Standard approaches to label encoding and performance measurement are insufficient for hierarchical tasks and must be replaced with specialized techniques.

### **3.1 Data Structuring and Preprocessing for Hierarchical Training**

To train a hierarchical classifier, the label information must be encoded in a format that makes the hierarchical relationships explicit to the model and its loss function. The optimal encoding strategy depends on the structure of the hierarchy (tree vs. DAG).

**Label Encoding for Tree Hierarchies:** For a simple tree-structured hierarchy, such as the two-level diagnostic taxonomy in PTB-XL, a straightforward approach is to create a separate target vector for each level of the hierarchy. For a given ECG sample, this would result in two label vectors:

1. A multi-hot encoded vector for the superclass level, with a '1' at the index corresponding to each present superclass (e.g., MI, CD).  
2. A multi-hot encoded vector for the subclass level, with a '1' at the index for each present specific diagnosis (e.g., AMI, CLBBB).

The model would then be designed with two corresponding output branches, each with its own loss calculation. The total loss would be a weighted sum of the losses from each level, encouraging the model to learn predictions at both coarse and fine granularities.

**Handling Multi-Label Hierarchies (DAGs):** When the hierarchy is a Directed Acyclic Graph (DAG), as is common in comprehensive ontologies like SNOMED-CT, a subclass can have multiple parents. This complicates label encoding. A simple multi-vector approach is no longer sufficient. One effective strategy is to represent the entire hierarchy as a single, large binary vector where each position corresponds to a node (class) in the DAG. A label of '1' indicates that the class is present for the given sample. A key constraint, known as the hierarchy constraint, must be enforced: if a node is labeled as '1', all of its ancestor nodes must also be labeled as '1'.17 The training process, particularly the loss function, must be designed to penalize violations of this constraint, ensuring that the model's predictions are logically consistent with the hierarchical structure.

### **3.2 Specialized Loss Functions and Performance Metrics**

Evaluating a hierarchical classifier with a simple, flat accuracy metric is profoundly misleading. It fails to differentiate between near-miss predictions and egregious errors, treating the misclassification of a subclass into a sibling class the same as a misclassification into a completely different branch of the hierarchy.53 To capture the nuances of hierarchical performance, specialized metrics are required.

**Hierarchical Precision, Recall, and F-Score:** These are set-based measures that provide a more meaningful assessment of performance. The calculation involves augmenting both the set of predicted labels and the set of true labels with all of their respective ancestors up to the root of the hierarchy. Hierarchical Precision (PH​) and Hierarchical Recall (RH​) are then calculated based on the intersection of these two augmented sets 53:

PH​=∣Y^aug​∣∣Y^aug​∩Yaug​∣​  
RH​=∣Yaug​∣∣Y^aug​∩Yaug​∣​  
where Y is the set of true labels, Y^ is the set of predicted labels, and the subscript aug denotes the ancestor-augmented sets. This method rewards a model for predicting a parent class even if it fails to predict the exact child class, reflecting the partial correctness of the prediction.

**Distance-Based Metrics:** An intuitive way to penalize hierarchical errors is to make the penalty proportional to the "distance" of the error in the hierarchy. The **tree distance loss** defines the cost of a misclassification as the length of the path (i.e., the number of edges) between the predicted node and the true node in the hierarchy tree.55 When used as a training objective, this loss function explicitly encourages the model to make predictions that are "close" to the correct answer, effectively teaching it to make "less wrong" mistakes.

**The Hierarchical Confusion Matrix:** A novel and powerful evaluation concept is the hierarchical confusion matrix. This approach redefines the fundamental components of a confusion matrix—True Positives (TP), False Positives (FP), False Negatives (FN), and True Negatives (TN)—in a hierarchical context.54 Instead of counting samples, these metrics count nodes along the prediction paths in the hierarchy:

* **Hierarchical True Positives (TPH​):** The number of nodes correctly included in the predicted path (i.e., nodes present in both the predicted and true paths).  
* **Hierarchical False Positives (FPH​):** The number of nodes in the predicted path that are not in the true path.  
* **Hierarchical False Negatives (FNH​):** The number of nodes in the true path that were missed by the predicted path.

By calculating these values for each sample and summing them across the dataset, one can construct a confusion matrix that accurately reflects hierarchical performance. From this matrix, familiar metrics like hierarchical precision (TPH​/(TPH​+FPH​)) and recall (TPH​/(TPH​+FNH​)) can be computed, providing a much richer and more interpretable diagnostic tool for analyzing model errors than any flat metric could offer.21

The strong connection between evaluation and training is a critical takeaway. The metrics used to judge a model's performance after training should logically align with the objective function used during training. A model optimized with a standard cross-entropy loss has no explicit incentive to learn the hierarchical relationships between classes. To build a truly hierarchically-aware model, it must be trained with a hierarchically-aware objective, such as a tree distance loss or a loss function derived from the principles of hierarchical precision and recall. In this way, the evaluation protocol directly drives the learning process, ensuring the model is optimized for the specific nuances of the hierarchical classification task.

---

## **Section 4: Strategic Recommendations and Future Directions**

Synthesizing the architectural paradigms, dataset characteristics, and evaluation protocols discussed, this final section provides actionable recommendations for practitioners embarking on hierarchical ECG classification. It offers a strategic guide for selecting the appropriate dataset and model architecture based on the specific clinical task, and concludes with a forward-looking perspective on the evolution of this promising field.

### **4.1 Task-Driven Dataset and Hierarchy Selection**

The foundational decision in any hierarchical classification project is the selection of a dataset and the definition of its corresponding hierarchy. This choice should be driven primarily by the intended clinical application, as different datasets and their inherent structures are suited for different tasks. The table below summarizes the characteristics and ideal use cases for the primary datasets discussed in this report, serving as a decision-making guide.

**Table 4.1: ECG Dataset Suitability for Hierarchical Tasks**

| Dataset | Hierarchy Type | Primary Use Case | Strengths | Challenges |
| :---- | :---- | :---- | :---- | :---- |
| **PTB-XL** | Explicit Diagnostic (SCP-ECG Tree) | Comprehensive clinical screening; general cardiac disease classification. | Standardized, validated multi-level hierarchy; large scale; rich metadata. | Significant class imbalance, especially at the subclass level. |
| **Chapman-Shaoxing** | Explicit Rhythm (Clinical Aggregation) | Specialized arrhythmia detection and classification. | Very large scale; focused on clinically relevant rhythm groupings. | Limited breadth of non-rhythm diagnostic labels. |
| **PhysioNet/CPSC** | Implicit (Requires Ontology Mapping) | Custom task formulation; research on novel hierarchies and ontology mapping. | Massive scale and diversity; multi-center data. | Requires extensive preprocessing and domain expertise to construct a hierarchy; label quality can be variable. |

Based on this analysis, a clear decision-making process emerges. For a project aiming to build a general-purpose diagnostic tool capable of identifying a wide range of cardiac conditions, the **PTB-XL dataset** is the unequivocal starting point due to its pre-defined, clinically validated diagnostic hierarchy. If the project's focus is more narrowly defined on arrhythmia classification, the **Chapman-Shaoxing dataset** with its rhythm-centric hierarchy offers a more tailored and powerful resource. Finally, for exploratory research aimed at defining novel clinical groupings or testing the scalability of hierarchy discovery methods, the large but unstructured datasets from the **PhysioNet and CPSC challenges** provide an ideal, albeit challenging, sandbox.

### **4.2 Model Architecture and Training Recommendations**

The choice of model architecture should follow from the choice of dataset and the complexity of its hierarchy.

* **For Tree-Structured Hierarchies (e.g., PTB-XL):** A **local, top-down approach** using a cascade of classifiers is a recommended starting point. This methodology is conceptually simpler to implement and debug than a global classifier. A practical implementation could involve training a first ResNet-based model to predict one of the five superclasses. Based on its prediction, the input ECG would then be passed to one of five specialized, second-stage models, each trained exclusively on the subclasses within a single superclass. This modular design allows for focused training and easier interpretation of errors at each stage.  
* **For Complex DAGs (from Ontology Mapping):** When the hierarchy is a complex Directed Acyclic Graph derived from an ontology like SNOMED-CT, a top-down approach becomes intractable. In this scenario, a **global classifier** is necessary. The model should be designed with a single, large output layer where each node corresponds to a class in the DAG. The primary focus of development should be on the loss function, which must be carefully crafted to enforce the hierarchy constraint, heavily penalizing predictions where a child node is active but any of its parents are not.

### **4.3 Future Directions: The Synergy of Large Data and Automated Discovery**

The future of hierarchical ECG classification lies in moving beyond the use of pre-defined taxonomies and toward the automated discovery of new, clinically meaningful hierarchies from massive datasets. The true potential of this field will be unlocked by combining the scale of datasets like those from the PhysioNet Challenges with the sophisticated hierarchy discovery techniques discussed in Section 1.3.

The ultimate objective is to develop end-to-end systems that can ingest hundreds of thousands or millions of ECGs with their associated free-text clinical reports and learn, without human supervision, the optimal hierarchical structure for representing the complex relationships between different cardiac pathologies. Such a system could potentially uncover novel groupings of conditions or identify subtle, intermediate disease states that are not captured by current, manually-defined classification systems. This represents a paradigm shift from using machine learning to solve problems within a known clinical framework to using machine learning to discover new frameworks and generate novel clinical knowledge. By integrating these data-driven discovery methods with the robust architectural and evaluation protocols outlined in this report, the field can move towards creating diagnostic AI that not only emulates but also extends the capabilities of human clinical expertise.

#### **引用的著作**

1. HMIC: Hierarchical Medical Image Classification, A Deep Learning ..., 访问时间为 八月 18, 2025， [https://pmc.ncbi.nlm.nih.gov/articles/PMC8346231/](https://pmc.ncbi.nlm.nih.gov/articles/PMC8346231/)  
2. Hierarchical Classification – a useful approach when predicting thousands of possible categories, 访问时间为 八月 18, 2025， [https://www.johnsnowlabs.com/hierarchical-classification-a-useful-approach-when-predicting-thousands-of-possible-categories/](https://www.johnsnowlabs.com/hierarchical-classification-a-useful-approach-when-predicting-thousands-of-possible-categories/)  
3. Hierarchical Adaptive Multi-task Learning Framework for Patient Diagnoses and Diagnostic Category Classification \- PMC, 访问时间为 八月 18, 2025， [https://pmc.ncbi.nlm.nih.gov/articles/PMC8049628/](https://pmc.ncbi.nlm.nih.gov/articles/PMC8049628/)  
4. e-SCP-ECG+ Protocol: An Expansion on SCP-ECG Protocol for Health Telemonitoring—Pilot Implementation \- PubMed Central, 访问时间为 八月 18, 2025， [https://pmc.ncbi.nlm.nih.gov/articles/PMC2901804/](https://pmc.ncbi.nlm.nih.gov/articles/PMC2901804/)  
5. SCP-ECG V3.0: An Enhanced Standard Communication Protocol for Computer-assisted Electrocardiography, 访问时间为 八月 18, 2025， [https://www.cinc.org/archives/2016/pdf/090-500.pdf](https://www.cinc.org/archives/2016/pdf/090-500.pdf)  
6. ECG Standards and Formats for Interoperability between mHealth and Healthcare Information Systems: A Scoping Review \- PMC, 访问时间为 八月 18, 2025， [https://pmc.ncbi.nlm.nih.gov/articles/PMC9565220/](https://pmc.ncbi.nlm.nih.gov/articles/PMC9565220/)  
7. SCP-ECG \- Wikipedia, 访问时间为 八月 18, 2025， [https://en.wikipedia.org/wiki/SCP-ECG](https://en.wikipedia.org/wiki/SCP-ECG)  
8. PTB-XL, a large publicly available Electrocardiography Dataset \- Fraunhofer Heinrich-Hertz-Institut, 访问时间为 八月 18, 2025， [https://iphome.hhi.de/samek/pdf/WagSciData20.pdf](https://iphome.hhi.de/samek/pdf/WagSciData20.pdf)  
9. s41597-020-0495-6 | PDF | Electrocardiography | Internal Medicine \- Scribd, 访问时间为 八月 18, 2025， [https://www.scribd.com/document/807679442/s41597-020-0495-6](https://www.scribd.com/document/807679442/s41597-020-0495-6)  
10. PTB-XL, a large publicly available electrocardiography dataset v1.0.3 \- PhysioNet, 访问时间为 八月 18, 2025， [https://physionet.org/content/ptb-xl/1.0.3/](https://physionet.org/content/ptb-xl/1.0.3/)  
11. (PDF) PTB-XL, a large publicly available electrocardiography dataset \- ResearchGate, 访问时间为 八月 18, 2025， [https://www.researchgate.net/publication/341618371\_PTB-XL\_a\_large\_publicly\_available\_electrocardiography\_dataset](https://www.researchgate.net/publication/341618371_PTB-XL_a_large_publicly_available_electrocardiography_dataset)  
12. PTB-XL, a large publicly available electrocardiography dataset \- PMC \- PubMed Central, 访问时间为 八月 18, 2025， [https://pmc.ncbi.nlm.nih.gov/articles/PMC7248071/](https://pmc.ncbi.nlm.nih.gov/articles/PMC7248071/)  
13. Bimodal CNN for cardiovascular disease classification by co-training ECG grayscale images and scalograms, 访问时间为 八月 18, 2025， [https://pmc.ncbi.nlm.nih.gov/articles/PMC9941114/](https://pmc.ncbi.nlm.nih.gov/articles/PMC9941114/)  
14. (PDF) A 12-lead Electrocardiogram Database for Arrhythmia ..., 访问时间为 八月 18, 2025， [https://www.researchgate.net/publication/339208642\_A\_12-lead\_Electrocardiogram\_Database\_for\_Arrhythmia\_Research\_Covering\_More\_Than\_10000\_Patients](https://www.researchgate.net/publication/339208642_A_12-lead_Electrocardiogram_Database_for_Arrhythmia_Research_Covering_More_Than_10000_Patients)  
15. (PDF) A survey of hierarchical classification across different ..., 访问时间为 八月 18, 2025， [https://www.researchgate.net/publication/225716424\_A\_survey\_of\_hierarchical\_classification\_across\_different\_application\_domains](https://www.researchgate.net/publication/225716424_A_survey_of_hierarchical_classification_across_different_application_domains)  
16. A Review of Performance Evaluation Measures for Hierarchical Classifiers \- AAAI, 访问时间为 八月 18, 2025， [https://cdn.aaai.org/Workshops/2007/WS-07-05/WS07-05-001.pdf](https://cdn.aaai.org/Workshops/2007/WS-07-05/WS07-05-001.pdf)  
17. Coherent Hierarchical Multi-Label Classification Networks, 访问时间为 八月 18, 2025， [https://proceedings.neurips.cc/paper/2020/file/6dd4e10e3296fa63738371ec0d5df818-Paper.pdf](https://proceedings.neurips.cc/paper/2020/file/6dd4e10e3296fa63738371ec0d5df818-Paper.pdf)  
18. Confusion Matrix in Machine Learning \- Analytics Vidhya, 访问时间为 八月 18, 2025， [https://www.analyticsvidhya.com/blog/2020/04/confusion-matrix-machine-learning/](https://www.analyticsvidhya.com/blog/2020/04/confusion-matrix-machine-learning/)  
19. Understanding the Confusion Matrix in Machine Learning \- GeeksforGeeks, 访问时间为 八月 18, 2025， [https://www.geeksforgeeks.org/machine-learning/confusion-matrix-machine-learning/](https://www.geeksforgeeks.org/machine-learning/confusion-matrix-machine-learning/)  
20. Extraction of object hierarchy data from trained deep-learning neural ..., 访问时间为 八月 18, 2025， [https://www.researchgate.net/publication/316260851\_Extraction\_of\_object\_hierarchy\_data\_from\_trained\_deep-learning\_neural\_networks\_via\_analysis\_of\_the\_confusion\_matrix](https://www.researchgate.net/publication/316260851_Extraction_of_object_hierarchy_data_from_trained_deep-learning_neural_networks_via_analysis_of_the_confusion_matrix)  
21. (PDF) Hierarchical confusion matrix for classification performance ..., 访问时间为 八月 18, 2025， [https://www.researchgate.net/publication/371684362\_Hierarchical\_confusion\_matrix\_for\_classification\_performance\_evaluation](https://www.researchgate.net/publication/371684362_Hierarchical_confusion_matrix_for_classification_performance_evaluation)  
22. Hierarchical Cluster Analysis – Applied Multivariate Statistics in R \- UW Pressbooks, 访问时间为 八月 18, 2025， [https://uw.pressbooks.pub/appliedmultivariatestatistics/chapter/hierarchical-cluster-analysis/](https://uw.pressbooks.pub/appliedmultivariatestatistics/chapter/hierarchical-cluster-analysis/)  
23. Hierarchical clustering from confusion matrix with python \- Stack Overflow, 访问时间为 八月 18, 2025， [https://stackoverflow.com/questions/18770348/hierarchical-clustering-from-confusion-matrix-with-python](https://stackoverflow.com/questions/18770348/hierarchical-clustering-from-confusion-matrix-with-python)  
24. Mastering Data Clustering with Embedding Models | Towards Dev \- Medium, 访问时间为 八月 18, 2025， [https://medium.com/towardsdev/mastering-data-clustering-with-embedding-models-87a228d67405](https://medium.com/towardsdev/mastering-data-clustering-with-embedding-models-87a228d67405)  
25. Hierarchical Level-Wise News Article Clustering via Multilingual Matryoshka Embeddings, 访问时间为 八月 18, 2025， [https://arxiv.org/html/2506.00277v1](https://arxiv.org/html/2506.00277v1)  
26. Objective-Based Hierarchical Clustering of Deep Embedding Vectors, 访问时间为 八月 18, 2025， [https://ojs.aaai.org/index.php/AAAI/article/view/17094/16901](https://ojs.aaai.org/index.php/AAAI/article/view/17094/16901)  
27. 2.3. Clustering — scikit-learn 1.7.1 documentation, 访问时间为 八月 18, 2025， [https://scikit-learn.org/stable/modules/clustering.html](https://scikit-learn.org/stable/modules/clustering.html)  
28. How I cluster/segment my text after embeddings process for easy understanding? \- API, 访问时间为 八月 18, 2025， [https://community.openai.com/t/how-i-cluster-segment-my-text-after-embeddings-process-for-easy-understanding/457670](https://community.openai.com/t/how-i-cluster-segment-my-text-after-embeddings-process-for-easy-understanding/457670)  
29. Label Hierarchy Transition: Delving into Class Hierarchies to ... \- arXiv, 访问时间为 八月 18, 2025， [https://arxiv.org/pdf/2112.02353](https://arxiv.org/pdf/2112.02353)  
30. ECG Signal Classification Using Deep Learning Techniques Based on the PTB-XL Dataset, 访问时间为 八月 18, 2025， [https://www.mdpi.com/1099-4300/23/9/1121](https://www.mdpi.com/1099-4300/23/9/1121)  
31. Automated ECG Interpretation \- Kaggle, 访问时间为 八月 18, 2025， [https://www.kaggle.com/code/zakikurdya/automated-ecg-interpretation](https://www.kaggle.com/code/zakikurdya/automated-ecg-interpretation)  
32. Deep Learning for ECG Analysis: Benchmarks and Insights from PTB-XL \- ResearchGate, 访问时间为 八月 18, 2025， [https://www.researchgate.net/publication/344215052\_Deep\_Learning\_for\_ECG\_Analysis\_Benchmarks\_and\_Insights\_from\_PTB-XL](https://www.researchgate.net/publication/344215052_Deep_Learning_for_ECG_Analysis_Benchmarks_and_Insights_from_PTB-XL)  
33. \[Re\] Deep Learning for ECG Analysis: Benchmarks and Insights from PTB-XL | medRxiv, 访问时间为 八月 18, 2025， [https://www.medrxiv.org/content/10.1101/2025.01.27.25321112v1.full-text](https://www.medrxiv.org/content/10.1101/2025.01.27.25321112v1.full-text)  
34. scp\_statements.csv \- PTB-XL, a large publicly available electrocardiography dataset \- PhysioNet, 访问时间为 八月 18, 2025， [https://physionet.org/content/ptb-xl/1.0.1/scp\_statements.csv](https://physionet.org/content/ptb-xl/1.0.1/scp_statements.csv)  
35. ecg\_aug/ptbxl\_dataset.py at main \- GitHub, 访问时间为 八月 18, 2025， [https://github.com/aniruddhraghu/ecg\_aug/blob/main/ptbxl\_dataset.py](https://github.com/aniruddhraghu/ecg_aug/blob/main/ptbxl_dataset.py)  
36. Chapman-Shaoxing 12-lead ECG Database \- Kaggle, 访问时间为 八月 18, 2025， [https://www.kaggle.com/datasets/erarayamorenzomuten/chapmanshaoxing-12lead-ecg-database](https://www.kaggle.com/datasets/erarayamorenzomuten/chapmanshaoxing-12lead-ecg-database)  
37. arxiv.org, 访问时间为 八月 18, 2025， [https://arxiv.org/html/2503.00711v1\#:\~:text=Chapman%20%5Cparencitebib23%3A%20The%20Chapman,a%20duration%20of%2010%20seconds.](https://arxiv.org/html/2503.00711v1#:~:text=Chapman%20%5Cparencitebib23%3A%20The%20Chapman,a%20duration%20of%2010%20seconds.)  
38. Shaoxing and Ningbo Hospital ECG Database \- Kaggle, 访问时间为 八月 18, 2025， [https://www.kaggle.com/datasets/bjoernjostein/shaoxing-and-ningbo-first-hospital-database](https://www.kaggle.com/datasets/bjoernjostein/shaoxing-and-ningbo-first-hospital-database)  
39. A large scale 12-lead electrocardiogram database for arrhythmia study v1.0.0 \- PhysioNet, 访问时间为 八月 18, 2025， [https://physionet.org/content/ecg-arrhythmia/](https://physionet.org/content/ecg-arrhythmia/)  
40. A 12-lead electrocardiogram database for arrhythmia research covering more than 10000 patients \- PubMed, 访问时间为 八月 18, 2025， [https://pubmed.ncbi.nlm.nih.gov/32051412/](https://pubmed.ncbi.nlm.nih.gov/32051412/)  
41. Research on a Lightweight Arrhythmia Classification Model Based on Knowledge Distillation for Wearable Single-Lead ECG Monitoring Systems \- MDPI, 访问时间为 八月 18, 2025， [https://www.mdpi.com/1424-8220/24/24/7896](https://www.mdpi.com/1424-8220/24/24/7896)  
42. Practical Lessons on 12-Lead ECG Classification: Meta-Analysis of Methods From PhysioNet/Computing in Cardiology Challenge 2020 \- Frontiers, 访问时间为 八月 18, 2025， [https://www.frontiersin.org/journals/physiology/articles/10.3389/fphys.2021.811661/epub](https://www.frontiersin.org/journals/physiology/articles/10.3389/fphys.2021.811661/epub)  
43. Classification of 12-lead ECGs: the PhysioNet/Computing in Cardiology Challenge 2020, 访问时间为 八月 18, 2025， [https://www.medrxiv.org/content/10.1101/2020.08.11.20172601v1.full-text](https://www.medrxiv.org/content/10.1101/2020.08.11.20172601v1.full-text)  
44. Automatic Detection for Multi-Labeled Cardiac Arrhythmia Based on Frame Blocking Preprocessing and Residual Networks \- PMC, 访问时间为 八月 18, 2025， [https://pmc.ncbi.nlm.nih.gov/articles/PMC8017170/](https://pmc.ncbi.nlm.nih.gov/articles/PMC8017170/)  
45. ECG Data Included in the CPSC2018 dataset. \- ResearchGate, 访问时间为 八月 18, 2025， [https://www.researchgate.net/figure/ECG-Data-Included-in-the-CPSC2018-dataset\_tbl1\_352517125](https://www.researchgate.net/figure/ECG-Data-Included-in-the-CPSC2018-dataset_tbl1_352517125)  
46. An Open Access Database for Evaluating the Algorithms of Electrocardiogram Rhythm and Morphology Abnormality Detection \- icbeb 2018, 访问时间为 八月 18, 2025， [http://2018.icbeb.org/file/2018X\_Feifei\_An%20Open%20Access%20Database%20for%20Evaluating%20ECG%20abnormal%20classificaition%20algorithm.pdf](http://2018.icbeb.org/file/2018X_Feifei_An%20Open%20Access%20Database%20for%20Evaluating%20ECG%20abnormal%20classificaition%20algorithm.pdf)  
47. A large-scale multi-label 12-lead electrocardiogram database with standardized diagnostic statements \- PubMed Central, 访问时间为 八月 18, 2025， [https://pmc.ncbi.nlm.nih.gov/articles/PMC9174207/](https://pmc.ncbi.nlm.nih.gov/articles/PMC9174207/)  
48. SNOMED CT to ICD-10-CM Map \- National Library of Medicine, 访问时间为 八月 18, 2025， [https://www.nlm.nih.gov/research/umls/mapping\_projects/snomedct\_to\_icd10cm.html](https://www.nlm.nih.gov/research/umls/mapping_projects/snomedct_to_icd10cm.html)  
49. (PDF) Leveraging Lexical Matching and Ontological Alignment to Map SNOMED CT Surgical Procedures to ICD-10-PCS \- ResearchGate, 访问时间为 八月 18, 2025， [https://www.researchgate.net/publication/317078825\_Leveraging\_Lexical\_Matching\_and\_Ontological\_Alignment\_to\_Map\_SNOMED\_CT\_Surgical\_Procedures\_to\_ICD-10-PCS](https://www.researchgate.net/publication/317078825_Leveraging_Lexical_Matching_and_Ontological_Alignment_to_Map_SNOMED_CT_Surgical_Procedures_to_ICD-10-PCS)  
50. WHO-FIC Classifications and Terminology Mapping \- World Health Organization (WHO), 访问时间为 八月 18, 2025， [https://cdn.who.int/media/docs/default-source/classification/who-fic-network/whofic\_terminology\_mapping\_guide.pdf](https://cdn.who.int/media/docs/default-source/classification/who-fic-network/whofic_terminology_mapping_guide.pdf)  
51. Dione: An OWL representation of ICD-10-CM for classifying patients' diseases \- PMC, 访问时间为 八月 18, 2025， [https://pmc.ncbi.nlm.nih.gov/articles/PMC5064922/](https://pmc.ncbi.nlm.nih.gov/articles/PMC5064922/)  
52. A SNOMED CT Mapping Guideline for the Local Terms Used to Document Clinical Findings and Procedures in Electronic Medical Records in South Korea: Methodological Study, 访问时间为 八月 18, 2025， [https://medinform.jmir.org/2023/1/e46127/](https://medinform.jmir.org/2023/1/e46127/)  
53. Evaluation Measures for Hierarchical Classification: a unified view and novel approaches, 访问时间为 八月 18, 2025， [https://www.researchgate.net/publication/243458423\_Evaluation\_Measures\_for\_Hierarchical\_Classification\_a\_unified\_view\_and\_novel\_approaches](https://www.researchgate.net/publication/243458423_Evaluation_Measures_for_Hierarchical_Classification_a_unified_view_and_novel_approaches)  
54. Hierarchical confusion matrix for classification performance ... \- arXiv, 访问时间为 八月 18, 2025， [https://arxiv.org/pdf/2306.09461](https://arxiv.org/pdf/2306.09461)  
55. Consistent Hierarchical Classification with A Generalized Metric \- Proceedings of Machine Learning Research, 访问时间为 八月 18, 2025， [https://proceedings.mlr.press/v238/cao24a/cao24a.pdf](https://proceedings.mlr.press/v238/cao24a/cao24a.pdf)